<% layout('layouts/boilerplate') -%>

  <section class="hero">
    <video autoplay muted loop playsinline class="hero-video">
      <source src="/videos/hero.mp4" type="video/mp4" />
    </video>

    <div class="hero-overlay"></div>

    <div class="hero-content">
      <div class="hero-card">
        <h1 class="hero-title">Stay Your Way</h1>
        <p class="hero-subtitle">
          Unique stays · Best prices · Anywhere you travel
        </p>

        <a href="#listings-section" class="hero-btn primary">
          Explore stays
        </a>
        <a href="/listings/new" class="hero-btn primary">
          Host Your Home
        </a>
        <h3>Your next stay starts here. Hand-crafted by <b>Kalava Dhilli Rao</b><a href="https://www.linkedin.com/in/kalavadhillirao/"><i class="fa-brands fa-linkedin"></i></a></h3>
        <h2></h2>
      </div>
      
    </div>
  </section>



  <div class="filters-bar">

    <!-- LEFT: CATEGORY FILTERS -->
    <div class="filters-left">
      <a href="/listings" class="filter-item <%= !category ? 'active' : '' %>">
        <i class="fa-solid fa-border-all"></i>
        <span>All</span>
      </a>

      <a href="/listings?category=beach" class="filter-item <%= category === 'beach' ? 'active' : '' %>">
        <i class="fa-solid fa-umbrella-beach"></i>
        <span>Beach</span>
      </a>

      <a href="/listings?category=mountain" class="filter-item <%= category === 'mountain' ? 'active' : '' %>">
        <i class="fa-solid fa-mountain"></i>
        <span>Mountain</span>
      </a>

      <a href="/listings?category=city" class="filter-item <%= category === 'city' ? 'active' : '' %>">
        <i class="fa-solid fa-city"></i>
        <span>City</span>
      </a>

      <a href="/listings?category=camping" class="filter-item <%= category === 'camping' ? 'active' : '' %>">
        <i class="fa-solid fa-campground"></i>
        <span>Camping</span>
      </a>

      <a href="/listings?category=luxury" class="filter-item <%= category === 'luxury' ? 'active' : '' %>">
        <i class="fa-solid fa-gem"></i>
        <span>Luxury</span>
      </a>
    </div>

    <!-- RIGHT: TAX + PRICE -->
    <div class="filters-right">

      <!-- TAX TOGGLE -->
      <div class="filter-card1">
        <span>Display total after taxes
          <label class="switch">
            <input type="checkbox" id="taxToggle">
            <span class="slider"></span>
          </label></span>
      

      <!-- PRICE RANGE -->
      <div class="filter-card">
        <span class="fw-semibold">Price range</span>
        <div class="price-display">
          ₹ <span id="priceMin">500</span> – ₹ <span id="priceMax">10000</span>
        </div>

        <input type="range" id="priceRange" min="500" max="10000" step="500" value="10000" />

        <button id="applyPrice" class="btn btn-dark btn-sm mt-2">
          Apply
        </button>
      </div>
      </div>

    </div>
  </div>

<!-- LISTINGS GRID -->
<div id="listings-section">
  <!-- <div class="row row-cols-xl-4 row-cols-lg-3 row-cols-md-2 row-cols-sm-1 g-4" id="listingGrid"> -->
    <div class="row row-cols-xxl-4 row-cols-lg-4 row-cols-md-2 row-cols-1 g-4" id="listingGrid">

    <% for (let listing of allListings) { %>
      <div class="col">

        <div class="listing-card">

          <!-- IMAGE WRAPPER -->
          <div class="listing-img-wrapper">

            <!-- ❤️ Wishlist Button -->
            <form
              action="/listings/<%= listing._id %>/wishlist"
              method="POST"
              class="wishlist-form"
            >
              <button type="submit" class="heart-btn">
                <i class="fa-heart 
                  <%= wishlistIds.includes(listing._id.toString()) 
                    ? 'fas text-danger' 
                    : 'far' %>">
                </i>
              </button>
            </form>

            <!-- IMAGE (clickable) -->
            <a href="/listings/<%= listing._id %>">
              <img
                src="<%= listing.image?.url || listing.image || 'https://images.unsplash.com/photo-1762770663487-6c03bb94fe84?auto=format&fit=crop&w=800&q=60' %>"
                alt="listing image"
                class="card-img-top"
              />
            </a>

          </div>

          <!-- CARD BODY -->
          <div class="card-body">
  <p class="listing-title"><%= listing.title %></p>

  <p class="listing-price" data-price="<%= listing.price %>">
    ₹ <span class="price-value">
      <%= listing.price.toLocaleString("en-IN") %>
    </span>
    <span class="night-text">/ night</span>
  </p>
</div>


        </div>

      </div>
    <% } %>

  </div>
</div>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const url = new URL(window.location.href);

      if (
        url.searchParams.has("category") ||
        url.searchParams.has("minPrice") ||
        url.searchParams.has("search")
      ) {
        const section = document.getElementById("listings-section");
        if (section) {
          section.scrollIntoView({ behavior: "smooth" });
        }
      }
    });
  </script>